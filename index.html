<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üö® –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞ - –•–∞—Ä–∫—ñ–≤</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white; line-height: 1.6; min-height: 100vh;
        }
        .container { max-width: 1600px; margin: 0 auto; padding: 15px; }
        
        /* –ë–û–¢ –°–¢–ê–¢–£–° */
        .bot-status {
            background: rgba(0, 136, 204, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 1px solid #0088cc;
            text-align: center;
        }
        .bot-btn {
            background: #0088cc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        
        /* –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° */
        header { 
            text-align: center; background: rgba(255, 255, 255, 0.08); 
            padding: 20px; border-radius: 15px; margin-bottom: 15px; 
            backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.1);
        }
        h1 { color: #ff6b6b; margin-bottom: 10px; font-size: 2.2em; }
        
        .stats-container { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); 
            gap: 15px; margin-bottom: 15px; 
        }
        .stat-card { 
            background: rgba(255, 255, 255, 0.08); padding: 20px; border-radius: 12px; 
            text-align: center; backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.1);
        }
        .stat-number { font-size: 2.2em; font-weight: bold; color: #ff6b6b; margin-bottom: 8px; }
        .stat-label { color: #ccc; font-size: 0.85em; }
        
        .map-container { 
            background: rgba(255, 255, 255, 0.08); padding: 15px; border-radius: 15px; 
            margin-bottom: 15px; backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.1);
        }
        #alertMap { 
            height: 600px; border-radius: 10px; overflow: hidden; 
        }
        
        .alerts-container { 
            background: rgba(255, 255, 255, 0.08); padding: 20px; border-radius: 15px; 
            margin-bottom: 15px; backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.1);
        }
        .alerts-list { max-height: 400px; overflow-y: auto; }
        .alert-item { 
            background: rgba(255, 255, 255, 0.1); border-left: 5px solid #ff6b6b; padding: 15px; 
            margin: 8px 0; border-radius: 8px;
        }
        .alert-item.rocket { border-left-color: #ff6b6b; }
        .alert-item.drone { border-left-color: #f39c12; }
        .alert-item.aircraft { border-left-color: #9b59b6; }
        .alert-item.recon { border-left-color: #3498db; }
        .alert-item.bot { border-left-color: #0088cc; }
        .alert-header { display: flex; justify-content: space-between; margin-bottom: 8px; }
        .alert-type { font-weight: bold; font-size: 1.1em; color: #ff6b6b; }
        .alert-source { 
            background: #666; color: white; padding: 2px 6px; border-radius: 10px; 
            font-size: 0.7em; margin-left: 5px;
        }
        .alert-source.bot { background: #0088cc; }
        .alert-source.admin { background: #00aa00; }
        .alert-location { background: #ff6b6b; color: white; padding: 4px 8px; border-radius: 15px; font-size: 0.75em; }
        .alert-time { color: #ccc; font-size: 0.8em; }
        .alert-message { margin-top: 8px; color: #eee; font-size: 0.9em; }
        .loading { text-align: center; padding: 30px; color: #ccc; }
        
        /* –°–¢–ò–õ–ò –î–õ–Ø –ö–ê–†–¢–ò–ù–û–ö –ú–ê–†–ö–ï–†–û–í */
        .custom-marker {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.5);
            background-size: cover;
            background-position: center;
        }
        .marker-rocket { border-color: #ff6b6b; }
        .marker-drone { border-color: #f39c12; }
        .marker-aircraft { border-color: #9b59b6; }
        .marker-recon { border-color: #3498db; }
        .marker-bot { border-color: #0088cc; }
    </style>
</head>
<body>
    <div class="container">
        <!-- –°–¢–ê–¢–£–° –ë–û–¢–ê -->
        <div class="bot-status">
            <h3>ü§ñ –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞</h3>
            <div style="margin: 10px 0;">
                <strong>–ë–æ—Ç –∞–∫—Ç–∏–≤–Ω–∏–π:</strong> 
                <a href="https://t.me/KharkivAlertsBot" target="_blank" style="color: #00FF00;">@KharkivAlertsBot</a>
            </div>
            <button class="bot-btn" onclick="openBot()">üí¨ –í—ñ–¥–∫—Ä–∏—Ç–∏ –±–æ—Ç–∞</button>
            <button class="bot-btn" onclick="testBotConnection()">üîó –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑'—î–¥–Ω–∞–Ω–Ω—è</button>
            <button class="bot-btn" onclick="getBotUpdates()">üîÑ –û–Ω–æ–≤–∏—Ç–∏ –¥–∞–Ω—ñ</button>
            
            <div style="margin-top: 10px; font-size: 0.9em; color: #ccc;">
                –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –±–æ—Ç–∞ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç—Ä–∏–≤–æ–≥ —Ç–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–æ—é
            </div>
        </div>

        <!-- –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° -->
        <header>
            <h1>üö® –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É —á–µ—Ä–µ–∑ –±–æ—Ç–∞</h1>
            <div class="last-update">
                –°—Ç–∞—Ç—É—Å: <span id="connectionStatus" class="status-online">–û—á—ñ–∫—É–≤–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥ –∑ –±–æ—Ç–∞</span> | 
                –û–Ω–æ–≤–ª–µ–Ω–Ω—è: <span id="lastUpdate">--:--:--</span> |
                –¢—Ä–∏–≤–æ–≥: <span id="alertsCount">0</span>
            </div>
        </header>

        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-number" id="totalAlerts">0</div>
                <div class="stat-label">–í—Å—å–æ–≥–æ —Ç—Ä–∏–≤–æ–≥</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="activeAlerts">0</div>
                <div class="stat-label">–ê–∫—Ç–∏–≤–Ω–∏—Ö –∑–∞–≥—Ä–æ–∑</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="rocketAlerts">0</div>
                <div class="stat-label">–†–∞–∫–µ—Ç–Ω–∏—Ö –∞—Ç–∞–∫</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="droneAlerts">0</div>
                <div class="stat-label">–î—Ä–æ–Ω—ñ–≤-–∫–∞–º—ñ–∫–∞–¥–∑–µ</div>
            </div>
        </div>

        <div class="map-container">
            <div id="alertMap"></div>
        </div>

        <div class="alerts-container">
            <h2>üì¢ –û—Å—Ç–∞–Ω–Ω—ñ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –∑ –±–æ—Ç–∞</h2>
            <div id="alertsList" class="alerts-list">
                <div class="loading">–û—á—ñ–∫—É–≤–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥ –∑ Telegram –±–æ—Ç–∞...</div>
            </div>
        </div>
    </div>

    <script>
        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
        const BOT_TOKEN = "8072675312:AAEsCXVL4RcSKNQasBTMGCcecZQoGsTCfkY";
        const BOT_ADMIN_IDS = ["123456789", "987654321"]; // ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –±–æ—Ç–∞
        
        // –ë–ê–ó–ê –õ–û–ö–ê–¶–ò–ô
        const locationsDB = {
            '–°–ª–æ–±—ñ–¥—Å—å–∫–∏–π —Ä–∞–π–æ–Ω': [50.005, 36.229],
            '–®–µ–≤—á–µ–Ω–∫—ñ–≤—Å—å–∫–∏–π —Ä–∞–π–æ–Ω': [49.993, 36.230],
            '–ö–∏—ó–≤—Å—å–∫–∏–π —Ä–∞–π–æ–Ω': [49.985, 36.280],
            '–ú–æ—Å–∫–æ–≤—Å—å–∫–∏–π —Ä–∞–π–æ–Ω': [49.970, 36.270],
            '–ù–µ–º–∏—à–ª—è–Ω—Å—å–∫–∏–π —Ä–∞–π–æ–Ω': [49.980, 36.340],
            '–Ü–Ω–¥—É—Å—Ç—Ä—ñ–∞–ª—å–Ω–∏–π —Ä–∞–π–æ–Ω': [49.920, 36.290],
            '–î–µ—Ä–≥–∞—á—ñ': [50.110, 36.120],
            '–ß—É–≥—É—ó–≤': [49.835, 36.686],
            '–ó–º—ñ—ó–≤': [49.674, 36.347],
            '–•–∞—Ä–∫—ñ–≤': [49.9935, 36.2304]
        };

        // –ö–ê–†–¢–ò–ù–ö–ò –î–õ–Ø –ú–ê–†–ö–ï–†–û–í
        const markerImages = {
            rocket: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMjAiIGZpbGw9IiNGRjZCNkIiLz4KPHBhdGggZD0iTTIwIDEwTDI2IDE2TDIwIDIyTDE0IDE2TDIwIDEwWiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+',
            drone: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMjAiIGZpbGw9IiNGMzlDMTIiLz4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iOCIgZmlsbD0id2hpdGUiLz4KPC9zdmc+',
            aircraft: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMjAiIGZpbGw9IiM5QjU5QjYiLz4KPHBhdGggZD0iTTIwIDEwTDMwIDE2TDIwIDIyTDEwIDE2TDIwIDEwWiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+',
            recon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMjAiIGZpbGw9IiMzNDk4REIiLz4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMTAiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPg==',
            bot: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMjAiIGZpbGw9IiMwMDg4Q0MiLz4KPGNpcmNsZSBjeD0iMTUiIGN5PSIxNSIgcj0iMiIgZmlsbD0id2hpdGUiLz4KPGNpcmNsZSBjeD0iMjUiIGN5PSIxNSIgcj0iMiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTE1IDI1QzE1IDIyIDIwIDIwIDIwIDIwQzI1IDIwIDMwIDIyIDMwIDI1IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIGZpbGw9Im5vbmUiLz4KPC9zdmc+'
        };

        let map;
        let alerts = [];
        let botUpdatesInterval;
        let lastBotUpdateId = 0;

        // –û–¢–ö–†–´–¢–ò–ï –ë–û–¢–ê
        function openBot() {
            window.open('https://t.me/KharkivAlertsBot', '_blank');
        }

        // –ü–†–û–í–ï–†–ö–ê –°–û–ï–î–ò–ù–ï–ù–ò–Ø –° –ë–û–¢–û–ú
        async function testBotConnection() {
            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getMe`);
                const data = await response.json();
                
                if (data.ok) {
                    alert(`‚úÖ –ë–æ—Ç –∞–∫—Ç–∏–≤–Ω–∏–π: ${data.result.first_name}\nUsername: @${data.result.username}`);
                    updateStatus('–ë–æ—Ç –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ', true);
                } else {
                    alert('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–æ—Ç–∞');
                    updateStatus('–ü–æ–º–∏–ª–∫–∞ –±–æ—Ç–∞', false);
                }
            } catch (error) {
                alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message);
                updateStatus('–ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ', false);
            }
        }

        // –ü–û–õ–£–ß–ï–ù–ò–ï –û–ë–ù–û–í–õ–ï–ù–ò–ô –û–¢ –ë–û–¢–ê
        async function getBotUpdates() {
            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getUpdates?offset=${lastBotUpdateId + 1}&timeout=10`);
                const data = await response.json();
                
                if (data.ok && data.result.length > 0) {
                    let newAlertsCount = 0;
                    
                    data.result.forEach(update => {
                        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–æ–º–∞–Ω–¥—ã –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
                        if (update.message && BOT_ADMIN_IDS.includes(update.message.from.id.toString())) {
                            processBotCommand(update.message);
                        }
                        
                        lastBotUpdateId = update.update_id;
                    });
                    
                    if (newAlertsCount > 0) {
                        updateStatus(`–û—Ç—Ä–∏–º–∞–Ω–æ ${newAlertsCount} –Ω–æ–≤–∏—Ö –∫–æ–º–∞–Ω–¥`, true);
                    } else {
                        updateStatus('–û—á—ñ–∫—É–≤–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥ –∑ –±–æ—Ç–∞', true);
                    }
                }
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω—å:', error);
            }
        }

        // –û–ë–†–ê–ë–û–¢–ö–ê –ö–û–ú–ê–ù–î –ë–û–¢–ê
        function processBotCommand(message) {
            const text = message.text;
            const chatId = message.chat.id;
            
            if (!text) return;
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –∞–¥–º–∏–Ω–∞
            if (text.startsWith('/add_alert')) {
                processAddAlertCommand(text, chatId);
            }
            else if (text.startsWith('/clear_alerts')) {
                processClearAlertsCommand(chatId);
            }
            else if (text.startsWith('/status')) {
                processStatusCommand(chatId);
            }
            else if (text.startsWith('/help')) {
                processHelpCommand(chatId);
            }
        }

        // –ö–û–ú–ê–ù–î–ê: –î–û–ë–ê–í–ò–¢–¨ –¢–†–ï–í–û–ì–£
        function processAddAlertCommand(commandText, chatId) {
            // –§–æ—Ä–º–∞—Ç: /add_alert —Ç–∏–ø –ª–æ–∫–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–µ
            const parts = commandText.split(' ');
            if (parts.length < 4) {
                sendBotMessage(chatId, '‚ùå –ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥–∏. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ: /add_alert —Ç–∏–ø –ª–æ–∫–∞—Ü—ñ—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è');
                return;
            }
            
            const type = parts[1];
            const location = parts[2];
            const message = parts.slice(3).join(' ');
            
            if (!['rocket', 'drone', 'aircraft', 'recon', 'alert'].includes(type)) {
                sendBotMessage(chatId, '‚ùå –ù–µ–≤—ñ—Ä–Ω–∏–π —Ç–∏–ø —Ç—Ä–∏–≤–æ–≥–∏. –î–æ–∑–≤–æ–ª–µ–Ω—ñ: rocket, drone, aircraft, recon, alert');
                return;
            }
            
            const coords = locationsDB[location] || [49.9935, 36.2304];
            createAlert(location, type, message, coords, 'bot');
            
            sendBotMessage(chatId, `‚úÖ –¢—Ä–∏–≤–æ–≥—É –¥–æ–¥–∞–Ω–æ!\nüìç ${location}\nüéØ ${getTypeName(type)}\nüí¨ ${message}`);
        }

        // –ö–û–ú–ê–ù–î–ê: –û–ß–ò–°–¢–ò–¢–¨ –¢–†–ï–í–û–ì–ò
        function processClearAlertsCommand(chatId) {
            alerts = [];
            
            if (map) {
                map.eachLayer(layer => {
                    if (layer instanceof L.Marker) {
                        map.removeLayer(layer);
                    }
                });
            }
            
            updateAllDisplays();
            sendBotMessage(chatId, 'üóëÔ∏è –í—Å—ñ —Ç—Ä–∏–≤–æ–≥–∏ –æ—á–∏—â–µ–Ω–æ!');
        }

        // –ö–û–ú–ê–ù–î–ê: –°–¢–ê–¢–£–°
        function processStatusCommand(chatId) {
            const activeAlerts = alerts.filter(a => (Date.now() - a.timestamp) < 30 * 60 * 1000);
            const stats = `üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º–∏:
‚Ä¢ –í—Å—å–æ–≥–æ —Ç—Ä–∏–≤–æ–≥: ${alerts.length}
‚Ä¢ –ê–∫—Ç–∏–≤–Ω–∏—Ö: ${activeAlerts.length}
‚Ä¢ –†–∞–∫–µ—Ç–Ω–∏—Ö: ${alerts.filter(a => a.type === 'rocket').length}
‚Ä¢ –î—Ä–æ–Ω—ñ–≤: ${alerts.filter(a => a.type === 'drone').length}
‚Ä¢ –õ—ñ—Ç–∞–∫—ñ–≤: ${alerts.filter(a => a.type === 'aircraft').length}
‚Ä¢ –†–æ–∑–≤—ñ–¥–Ω–∏–∫—ñ–≤: ${alerts.filter(a => a.type === 'recon').length}`;
            
            sendBotMessage(chatId, stats);
        }

        // –ö–û–ú–ê–ù–î–ê: –ü–û–ú–û–©–¨
        function processHelpCommand(chatId) {
            const helpText = `ü§ñ –ö–æ–º–∞–Ω–¥–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞:

üö® –î–æ–¥–∞—Ç–∏ —Ç—Ä–∏–≤–æ–≥—É:
/add_alert —Ç–∏–ø –ª–æ–∫–∞—Ü—ñ—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
–ü—Ä–∏–∫–ª–∞–¥: /add_alert rocket –°–ª–æ–±—ñ–¥—Å—å–∫–∏–π_—Ä–∞–π–æ–Ω –†–∞–∫–µ—Ç–Ω–∞_–∞—Ç–∞–∫–∞

üóëÔ∏è –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è:
/clear_alerts - –æ—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ —Ç—Ä–∏–≤–æ–≥–∏
/status - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º–∏

üéØ –¢–∏–ø–∏ —Ç—Ä–∏–≤–æ–≥:
‚Ä¢ rocket - —Ä–∞–∫–µ—Ç–∞/–±–∞–ª—ñ—Å—Ç–∏–∫–∞
‚Ä¢ drone - –¥—Ä–æ–Ω-–∫–∞–º—ñ–∫–∞–¥–∑–µ
‚Ä¢ aircraft - –ª—ñ—Ç–∞–∫ (–°—É-34/35)
‚Ä¢ recon - –ë–ü–õ–ê —Ä–æ–∑–≤—ñ–¥–Ω–∏–∫
‚Ä¢ alert - –ø–æ–≤—ñ—Ç—Ä—è–Ω–∞ —Ç—Ä–∏–≤–æ–≥–∞

üìç –õ–æ–∫–∞—Ü—ñ—ó: –°–ª–æ–±—ñ–¥—Å—å–∫–∏–π_—Ä–∞–π–æ–Ω, –®–µ–≤—á–µ–Ω–∫—ñ–≤—Å—å–∫–∏–π_—Ä–∞–π–æ–Ω, –î–µ—Ä–≥–∞—á—ñ, –•–∞—Ä–∫—ñ–≤, —Ç–æ—â–æ`;

            sendBotMessage(chatId, helpText);
        }

        // –û–¢–ü–†–ê–í–ö–ê –°–û–û–ë–©–ï–ù–ò–Ø –í –ë–û–¢
        async function sendBotMessage(chatId, text) {
            try {
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: chatId,
                        text: text,
                        parse_mode: 'HTML'
                    })
                });
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:', error);
            }
        }

        // –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –°–ò–°–¢–ï–ú–´
        function createAlert(location, type, message, coords, source = 'bot') {
            const alert = {
                id: Date.now() + Math.random(),
                type: type,
                location: location,
                coords: coords,
                message: message,
                time: new Date().toLocaleTimeString('uk-UA'),
                timestamp: Date.now(),
                source: source
            };
            
            alerts.unshift(alert);
            addAlertMarker(alert);
            updateAllDisplays();
            
            console.log('‚úÖ –î–æ–¥–∞–Ω–æ —Ç—Ä–∏–≤–æ–≥—É –∑ –±–æ—Ç–∞:', alert);
        }

        function addAlertMarker(alert) {
            const markerClass = 'marker-' + alert.type;
            const markerImage = markerImages[alert.type] || markerImages.bot;

            const icon = L.divIcon({
                html: `<div class="custom-marker ${markerClass}" style="background-image: url('${markerImage}')"></div>`,
                className: 'custom-marker-icon',
                iconSize: [40, 40],
                iconAnchor: [20, 20]
            });

            const marker = L.marker(alert.coords, { icon: icon }).addTo(map);
            alert.marker = marker;
            
            marker.bindPopup(`
                <div style="color: black; min-width: 300px;">
                    <strong style="color: #ff6b6b; font-size: 1.1em;">
                        ${getTypeName(alert.type)}
                    </strong><br>
                    <b>–õ–æ–∫–∞—Ü—ñ—è:</b> ${alert.location}<br>
                    <b>–ß–∞—Å:</b> ${alert.time}<br>
                    <b>–î–∂–µ—Ä–µ–ª–æ:</b> <span style="color: #0088cc">ü§ñ –ë–æ—Ç</span><br>
                    <b>–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:</b> ${alert.message}
                </div>
            `);
            
            marker.openPopup();
        }

        function getTypeName(type) {
            const names = {
                rocket: 'üöÄ –†–∞–∫–µ—Ç–∞ / –ë–∞–ª—ñ—Å—Ç–∏–∫–∞',
                drone: 'üõ∏ –®–∞—Ö–µ–¥ / –î—Ä–æ–Ω-–∫–∞–º—ñ–∫–∞–¥–∑–µ',
                aircraft: '‚úàÔ∏è –õ—ñ—Ç–∞–∫ (–°—É-34/35)',
                recon: 'üì° –ë–ü–õ–ê —Ä–æ–∑–≤—ñ–¥–Ω–∏–∫ / –§–ü–í',
                alert: '‚ö†Ô∏è –ü–æ–≤—ñ—Ç—Ä—è–Ω–∞ —Ç—Ä–∏–≤–æ–≥–∞'
            };
            return names[type] || type;
        }

        // –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê
        function updateAllDisplays() {
            updateStats();
            updateAlertsList();
            updateLastUpdateTime();
        }

        function updateStats() {
            const now = Date.now();
            const activeAlerts = alerts.filter(a => (now - a.timestamp) < 30 * 60 * 1000);
            
            document.getElementById('totalAlerts').textContent = alerts.length;
            document.getElementById('activeAlerts').textContent = activeAlerts.length;
            document.getElementById('rocketAlerts').textContent = alerts.filter(a => a.type === 'rocket').length;
            document.getElementById('droneAlerts').textContent = alerts.filter(a => a.type === 'drone').length;
            document.getElementById('alertsCount').textContent = alerts.length;
        }

        function updateAlertsList() {
            const alertsList = document.getElementById('alertsList');
            
            if (alerts.length === 0) {
                alertsList.innerHTML = '<div class="loading">–ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–∏—Ö —Ç—Ä–∏–≤–æ–≥. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –±–æ—Ç–∞ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è.</div>';
                return;
            }
            
            alertsList.innerHTML = '';
            alerts.slice(0, 15).forEach(alert => {
                const alertElement = document.createElement('div');
                alertElement.className = `alert-item ${alert.type} bot`;
                alertElement.innerHTML = `
                    <div class="alert-header">
                        <span class="alert-type">${getTypeName(alert.type)}</span>
                        <span class="alert-source bot">ü§ñ –ë–æ—Ç</span>
                    </div>
                    <div class="alert-location">${alert.location}</div>
                    <div class="alert-time">${alert.time}</div>
                    <div class="alert-message">${alert.message}</div>
                `;
                alertsList.appendChild(alertElement);
            });
        }

        function updateLastUpdateTime() {
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('uk-UA');
        }

        function updateStatus(message, isOnline) {
            const statusElement = document.getElementById('connectionStatus');
            statusElement.textContent = message;
            statusElement.className = isOnline ? 'status-online' : 'status-offline';
        }

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ö–ê–†–¢–´
        function initMap() {
            if (map) return;
            
            map = L.map('alertMap').setView([49.9935, 36.2304], 11);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
        }

        // –ó–ê–ü–£–°–ö –°–ò–°–¢–ï–ú–´
        function startBotMonitoring() {
            if (botUpdatesInterval) {
                clearInterval(botUpdatesInterval);
            }
            
            getBotUpdates();
            botUpdatesInterval = setInterval(getBotUpdates, 5000); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        }

        // –ê–í–¢–û–ó–ê–ü–£–°–ö
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            testBotConnection();
            startBotMonitoring();
            updateStatus('–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞. –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥ –∑ –±–æ—Ç–∞...', true);
        });
    </script>
</body>
</html>